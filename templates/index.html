<!DOCTYPE html>
<html>
<head>
    <title>Inventory Order System</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>

<body>

    <div class="app-container">

        <header class="app-header">
            <img
                src="{{ url_for('static', filename='images/redchurch-logo.webp') }}"
                alt="Redchurch Cafe"
                class="app-logo"
            />
            <div class="app-title">
                <span>Paper Goods Ordering Tool</span>
            </div>
        </header>

        <!-- SEARCH -->
        <form class="search-bar" onsubmit="return false;">
            <input
                type="text"
                name="q"
                id="searchInput"
                placeholder="Search SKU or Name"
                value="{{ query }}"
            >
            <button type="submit" class="search-btn">Search</button>
            <button type="button" class="secondary-btn" id="resetSearchBtn">
                Reset
            </button>
        </form>

        <!-- TOP ACTIONS -->
        <div class="top-actions">
            <button class="primary-btn" id="toggleAddItemBtn">âž• Add New Item</button>
            <button class="secondary-btn" id="viewSummaryBtn">ðŸ“‹ View Order Summary</button>
            <button class="primary-btn" id="emailOrder">ðŸ“§ Email Order to Gmail</button>

        </div>

        <!-- ADD ITEM -->
        <div id="addItemBox" class="add-item-box hidden">
            <form method="post" action="/add_item">
                <input name="sku" placeholder="SKU" required>
                <input name="name" placeholder="Product Name" required>
                <input name="unit" placeholder="Unit Type" required>
                <label class="field-label">Product Type</label>
                <select name="type" class="field-input" required>
                    <option value="" disabled selected>
                        Select a type
                    </option>

                    {% for t in product_types %}
                        <option value="{{ t }}">{{ t }}</option>
                    {% endfor %}
                </select>

                <div class="form-actions">
                    <button class="primary-btn">Save</button>
                    <button type="button" class="secondary-btn" id="cancelAddItemBtn">Cancel</button>
                </div>
                
            </form>
        </div>

        <!-- CATALOG (READ-ONLY) -->
        <table>
            <tr>
                <th>SKU</th>
                <th>Name</th>
                <th>Unit</th>
                <th class="qty-col">Qty</th>
                <th class="action-col">Action</th>
            </tr>

            <tbody>
                {% set ns = namespace(last_type=None) %}

                {% for item in items %}

                    {% if item.type != ns.last_type %}
                        <tr class="section-header">
                            <td colspan="5">
                                {{ item.type }}
                            </td>
                        </tr>
                        {% set ns.last_type = item.type %}
                    {% endif %}

                <tr class="product-row">
                    <td class="sku">{{ item.sku }}</td>
                    <td class="name">
                        <span class="item-name">
                            {{ item.display_name or item.name }}
                        </span>

                        {% if item.description %}
                            <span class="info-icon" tabindex="0">â“˜</span>
                            <div class="tooltip">
                            {{ item.description }}
                            </div>
                        {% endif %}
                    </td>

                    <td>{{ item.unit }}</td>

                    <td class="qty-col">
                        <form class="add-to-order-form">
                            <input type="hidden" name="sku" value="{{ item.sku }}">

                            <div class="qty-control">
                                <button type="button" class="qty-btn minus">âˆ’</button>

                                <input
                                    type="hidden"
                                    name="qty"
                                    value="1"
                                    class="qty-input"
                                />

                                <span class="qty-display">1</span>

                                <button type="button" class="qty-btn plus">+</button>
                            </div>

                    </td>

                    <td class="action-col">
                            <button class="primary-btn">
                                Add to Order
                            </button>
                        </form>
                    </td>
                </tr>


                {% endfor %}
            </tbody>


        </table>

        <!-- ORDER SUMMARY MODAL -->
        <div id="orderSummaryModal" class="modal hidden">
            <div class="modal-content">
                <h3>Order Summary</h3>

                <div id="summaryList">
                    <!-- JS will populate this -->
                </div>

                <div class="modal-actions">
                    <button class="primary-btn" id="copySummaryBtn">
                        ðŸ“‹ Copy to Clipboard
                    </button>
                    <button class="secondary-btn" id="closeSummaryBtn">
                        Close
                    </button>
                </div>
            </div>
        </div>


        <script src="{{ url_for('static', filename='script.js') }}"></script>
    </div>
</body>
</html>
