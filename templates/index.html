<!DOCTYPE html>
<html>
<head>
    <title>Inventory Order System</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>

<body>

<h2>Redchurch Paper Goods Ordering Tool</h2>

<!-- SEARCH -->
<form method="get" class="search-bar">
    <input
        type="text"
        name="q"
        id="searchInput"
        placeholder="Search SKU or Name"
        value="{{ query }}"
    >
    <button type="submit" class="search-btn">Search</button>
    <button type="button" class="secondary-btn" id="resetSearchBtn">
        Reset
    </button>
</form>

<!-- TOP ACTIONS -->
<div class="top-actions">
    <button class="primary-btn" id="toggleAddItemBtn">âž• Add New Item</button>
    <button class="secondary-btn" id="viewSummaryBtn">ðŸ“‹ View Order Summary</button>
    <button class="primary-btn" id="emailOrder">ðŸ“§ Email Order to Gmail</button>

</div>

<!-- ADD ITEM -->
<div id="addItemBox" class="add-item-box hidden">
    <form method="post" action="/add_item">
        <input name="sku" placeholder="SKU" required>
        <input name="name" placeholder="Product Name" required>
        <input name="unit" placeholder="Unit Type" required>
        <button class="primary-btn">Save</button>
        <button type="button" class="secondary-btn" id="cancelAddItemBtn">Cancel</button>
    </form>
</div>

<!-- CATALOG (READ-ONLY) -->
<table>
<tr>
    <th>SKU</th>
    <th>Name</th>
    <th>Unit</th>
    <th>Qty</th>
    <th>Action</th>
</tr>

{% for item in items %}
<tr>
    <td>{{ item.sku }}</td>
    <td>{{ item.name }}</td>
    <td>{{ item.unit }}</td>
    <td>
        <form class="add-to-order-form"
            data-sku="{{ item.sku }}"
            data-name="{{ item.name }}"
            data-unit="{{ item.unit }}">

            <input type="hidden" name="sku" value="{{ item.sku }}">
            <input type="number" name="qty" value="1" min="1" class="inline-input">
    </td>
    <td>
            <button>Add to Order</button>
        </form>
    </td>
</tr>
{% endfor %}
</table>

<!-- ORDER SUMMARY MODAL -->
<div id="orderSummaryModal" class="modal hidden">
    <div class="modal-content">
        <h3>Order Summary</h3>

        {% set ordered = [] %}
        {% for i in items %}
            {% if i.sku in orders %}
                {% set _ = ordered.append(i) %}
            {% endif %}
        {% endfor %}

        {% if ordered|length > 0 %}
            <div class="summary-list" id="orderSummaryText">
                {% for i in ordered %}
                    <div class="summary-row">
                        {{ orders[i.sku] }} {{ i.unit }}(s) â€“ [{{ i.sku }}] â€“ {{ i.name }}

                        <form class="remove-from-order-form">
                            <input type="hidden" name="sku" value="{{ i.sku }}">
                            <button class="secondary-btn">Remove</button>
                        </form>
                    </div>
                {% endfor %}
            </div>
        {% else %}
            <p id="orderSummaryText">No items in the order yet.</p>
        {% endif %}

        <div class="modal-actions">
            <button class="primary-btn" id="copySummaryBtn">
                ðŸ“‹ Copy to Clipboard
            </button>
            <button class="secondary-btn" id="closeSummaryBtn">
                Close
            </button>
        </div>
    </div>
</div>


<script src="{{ url_for('static', filename='script.js') }}"></script>
</body>
</html>
